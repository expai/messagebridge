# MessageBridge - Secure Payment Webhook Gateway

–ù–∞–¥–µ–∂–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Go –¥–ª—è –ø—Ä–∏–µ–º–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö webhook'–æ–≤ —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π –≤ Apache Kafka –∏–ª–∏ —É–¥–∞–ª–µ–Ω–Ω—ã–µ URL'—ã.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ù–∞–¥–µ–∂–Ω—ã–π –ø—Ä–∏–µ–º webhook'–æ–≤** - HTTP —Å–µ—Ä–≤–µ—Ä —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–∞–Ω–∏–∫ –∏ graceful shutdown
- **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞** - —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ SQLite –ø—Ä–∏ —Å–±–æ—è—Ö
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Kafka** - –ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (SASL, TLS)
- **–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–µ URL** - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Kafka —Å retry –ª–æ–≥–∏–∫–æ–π
- **Worker –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ (–≤–∫–ª—é—á–∞—è –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏)
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ health check'–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∑–∞—â–∏—â–µ–Ω–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ systemd –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
HTTP Request ‚Üí Server ‚Üí Handler ‚Üí [Kafka|Remote URL]
                  ‚Üì (on failure)
               SQLite ‚Üê Worker ‚Üí [Kafka|Remote URL]
```

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ò–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/expai/messagebridge.git
cd messagebridge

# –°–±–æ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞
make deps
make install
```

### Docker

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
make docker-build

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -d \
  --name messagebridge \
  -p 8080:8080 \
  -v $(pwd)/config.yaml:/etc/messagebridge/config.yaml \
  -v messagebridge-data:/var/lib/messagebridge \
  messagebridge:latest
```

### üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ —Ä–µ–ª–∏–∑–∞
wget https://github.com/expai/messagebridge/releases/latest/download/messagebridge-linux-amd64.tar.gz
tar -xzf messagebridge-linux-amd64.tar.gz
cd messagebridge-*/

# –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å nginx
sudo ./scripts/install.sh

# –ò–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo ./scripts/install.sh --minimal

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
./scripts/install.sh --help
```

**–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –û–° (Ubuntu, Debian, Arch Linux)
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (SQLite, nginx)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–∞ —Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx —Å SSL –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ –ì–æ—Ç–æ–≤–∞—è production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ï—Å–ª–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ —Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É
sudo cp messagebridge /usr/local/bin/
sudo chmod +x /usr/local/bin/messagebridge
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
server:
  host: "0.0.0.0"
  port: 8080

routes:
  - path: "/webhook/payment"
    queue: "payment-events"

kafka:
  brokers:
    - "localhost:9092"

worker:
  retry_interval: 5m       # How often to check for failed messages
  batch_size: 50           # Messages to fetch per batch (sent individually)
  max_retries: 0           # Retry attempts (0 = unlimited until success)
```

### –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
server:
  host: "0.0.0.0"
  port: 8080

routes:
  - path: "/webhook/payment"
    queue: "payment-events"
  - path: "/webhook/user"
    queue: "user-events"
  - path: "/webhook/order"
    queue: "order-events"

kafka:
  brokers:
    - "kafka1:9092"
    - "kafka2:9092"
  security_protocol: "SASL_SSL"
  sasl_mechanism: "SCRAM-SHA-256"
  sasl_username: "your-username"
  sasl_password: "your-password"
  tls_enabled: true
  retry_max: 3
  retry_backoff: 2s
  batch_size: 100
  timeout: 30s

sqlite:
  database_path: "/var/lib/sbphub/messages.db"

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Kafka - –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π URL
remote_url:
  url: "https://api.example.com/webhooks"
  timeout: 30s
  retries: 3

worker:
  retry_interval: 5m       # How often to check for failed messages  
  batch_size: 50           # Messages to fetch per batch (sent individually)
  max_retries: 0           # Retry attempts (0 = unlimited until success)
```

## üöÄ –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
make run-dev

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
./messagebridge -config config.yaml
```

### –ö–∞–∫ —Å–∏—Å—Ç–µ–º–Ω–∞—è —Å–ª—É–∂–±–∞

```bash
# –ü–æ—Å–ª–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å —É–∂–µ –∑–∞–ø—É—â–µ–Ω!
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status messagebridge

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º
sudo systemctl start messagebridge
sudo systemctl stop messagebridge
sudo systemctl restart messagebridge

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo journalctl -u messagebridge -f
```

### üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx –∏ SSL

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–∑–¥–∞—ë—Ç –≥–æ—Ç–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo apt install certbot python3-certbot-nginx  # Ubuntu/Debian
sudo pacman -S certbot certbot-nginx            # Arch Linux

# 2. –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
sudo certbot --nginx -d your-webhook-domain.com

# 3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nano /etc/messagebridge/config.yaml
# –ò–∑–º–µ–Ω–∏—Ç–µ:
# nginx:
#   domain: "your-webhook-domain.com"
# remote_url:
#   url: "https://your-api.com/webhooks"

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
sudo systemctl restart messagebridge nginx
```

### –í Docker

```bash
# –ó–∞–ø—É—Å–∫ —Å docker-compose
docker-compose up -d

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
docker run -d \
  --name messagebridge \
  -p 8080:8080 \
  -v ./config.yaml:/etc/messagebridge/config.yaml \
  messagebridge:latest
```

## üì° API

### Webhook —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ webhook'–∞
curl -X POST http://localhost:8080/webhook/payment \
  -H "Content-Type: application/json" \
  -d '{"order_id": "12345", "amount": 100.00, "currency": "USD"}'

# –û—Ç–≤–µ—Ç
{
  "message_id": "abc123def456",
  "status": "accepted",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# Health check
curl http://localhost:8080/health

# –°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl http://localhost:8080/status
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ó–∞–ø—É—Å–∫ –ø–æ–¥ –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- –ò–∑–æ–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (systemd)
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

### –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TLS –¥–ª—è Kafka
- SASL –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- Timeout'—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ç–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞ Docker
- –ó–∞–ø—É—Å–∫ –ø–æ–¥ non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ Alpine
- Health check'–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.24+
- GCC (–¥–ª—è SQLite)
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
make deps

# –°–±–æ—Ä–∫–∞
make build

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make test
make test-race

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
make fmt

# –õ–∏–Ω—Ç–∏–Ω–≥
make lint

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ webhook'–∞
make test-webhook
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
messagebridge/
‚îú‚îÄ‚îÄ config/         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ models/         # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ storage/        # SQLite —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îú‚îÄ‚îÄ kafka/          # Kafka producer
‚îú‚îÄ‚îÄ httpclient/     # HTTP –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ server/         # HTTP —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ worker/         # Background worker
‚îú‚îÄ‚îÄ handler/        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ examples/       # –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ deployments/    # –§–∞–π–ª—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ go.mod          # Go modules (github.com/expai/messagebridge)
‚îî‚îÄ‚îÄ main.go         # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª
```

### Go –º–æ–¥—É–ª–∏

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã —Å–æ–≥–ª–∞—Å–Ω–æ Go best practices:

```go
import (
    "github.com/expai/messagebridge/config"
    "github.com/expai/messagebridge/models"
)
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
sudo journalctl -u messagebridge -f

# Docker –ª–æ–≥–∏
docker logs -f messagebridge
```

### –ú–µ—Ç—Ä–∏–∫–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

- `/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `/status` - —Å—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ê–ª–µ—Ä—Ç—ã

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ exit –∫–æ–¥—ã:

- `0` - –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- `1` - –æ—à–∏–±–∫–∞
- `2` - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

## üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

1. **Panic recovery** - –ø–µ—Ä–µ—Ö–≤–∞—Ç –ø–∞–Ω–∏–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
2. **SQLite backup** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
3. **Worker retry** - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å –≥–∏–±–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
4. **Health monitoring** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### üîÅ Worker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

Worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff:

```yaml
worker:
  retry_interval: 5m       # –ö–∞–∫ —á–∞—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  batch_size: 50           # –°–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞–±–∏—Ä–∞—Ç—å –∑–∞ —Ä–∞–∑ (–æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É!)
  max_retries: 0           # –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: 0 = –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ –¥–æ —É—Å–ø–µ—Ö–∞
```

**–õ–æ–≥–∏–∫–∞ retry:**
- `max_retries: 0` - worker –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å **–Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑** –¥–æ —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏
- `max_retries: 5` - –ø–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `failed`
- `batch_size: 50` - –∏–∑ –±–∞–∑—ã –∑–∞–±–∏—Ä–∞–µ—Ç—Å—è 50 —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–æ **–∫–∞–∂–¥–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ**
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 2 –º–∏–Ω ‚Üí 4 –º–∏–Ω ‚Üí 8 –º–∏–Ω ‚Üí 16 –º–∏–Ω...

### –†—É—á–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã
sudo systemctl restart messagebridge

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏
sudo journalctl -u messagebridge --since "1 hour ago"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sqlite3 /var/lib/messagebridge/messages.db "SELECT COUNT(*) FROM messages WHERE status='pending';"
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Kafka**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é brokers
   - –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ SASL –Ω–∞—Å—Ç—Ä–æ–µ–∫
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

2. **–û—à–∏–±–∫–∏ SQLite**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

3. **HTTP –æ—à–∏–±–∫–∏**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–Ω—è—Ç–æ—Å—Ç—å –ø–æ—Ä—Ç–∞
   - –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–æ—É—Ç–æ–≤

### –í–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏

```bash
# –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
export LOG_LEVEL=debug
./messagebridge -config config.yaml
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

```bash
# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
make fix-permissions

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
sudo ./scripts/fix-permissions.sh
```

### –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –Ω–µ–ø–æ–ª–∞–¥–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ [TROUBLESHOOTING.md](TROUBLESHOOTING.md), –≤–∫–ª—é—á–∞—è:

- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û—à–∏–±–∫–∏ –∑–∞–ø—É—Å–∫–∞ —Å–ª—É–∂–±—ã  
- –ü—Ä–æ–±–ª–µ–º—ã —Å SSL/TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

```bash
# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é)
sudo ./scripts/uninstall.sh

# –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–≤–∫–ª—é—á–∞—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ nginx)
sudo ./scripts/uninstall.sh --remove-data --remove-nginx

# –ß–µ—Ä–µ–∑ Makefile
make uninstall-safe     # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
make uninstall-full     # –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
```

### –†—É—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl stop messagebridge
sudo systemctl disable messagebridge

# –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
sudo rm -f /etc/systemd/system/messagebridge.service
sudo rm -f /usr/local/bin/messagebridge

# –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
sudo rm -rf /etc/messagebridge /var/lib/messagebridge /var/log/messagebridge

# –£–¥–∞–ª–µ–Ω–∏–µ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
sudo rm -f /etc/nginx/sites-enabled/messagebridge
sudo rm -f /etc/nginx/sites-available/messagebridge

# –£–¥–∞–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo userdel messagebridge

sudo systemctl daemon-reload
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:

- GitHub Issues: [—Å–æ–∑–¥–∞—Ç—å issue](https://github.com/expai/messagebridge/issues)
- Email: support@yourcompany.com

## üè∑Ô∏è –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç [Semantic Versioning](https://semver.org/):

- `MAJOR.MINOR.PATCH`
- Changelog –≤ [CHANGELOG.md](CHANGELOG.md) 